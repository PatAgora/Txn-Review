<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Change Password - Transaction Review Tool</title>
    <link href="/static/vendor/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/change_password.css" rel="stylesheet">
  </head>
  <body>
    <div class="password-card">
      <div class="password-header">
        <h1>üîê Change Password</h1>
        <small>You must change your password to continue</small>
      </div>
      <div class="password-body">
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="alert alert-warning">{{ messages[0] }}</div>
          {% endif %}
        {% endwith %}
        
        <div class="requirements">
          <strong>Password Requirements:</strong>
          <ul>
            <li>Minimum 10 characters</li>
            <li>At least one uppercase letter (A-Z)</li>
            <li>At least one lowercase letter (a-z)</li>
            <li>At least one number (0-9)</li>
            <li>At least one special character (!@#$%^&* etc.)</li>
          </ul>
        </div>
        
        <form method="post">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <div class="mb-3">
            <label for="current_password" class="form-label">Current Password</label>
            <input type="password" class="form-control" id="current_password" name="current_password" required autofocus>
          </div>
          <div class="mb-3">
            <label for="new_password" class="form-label">New Password</label>
            <input type="password" class="form-control" id="new_password" name="new_password" required 
                   pattern=".{10,}" title="Minimum 10 characters">
          </div>
          <div class="mb-3">
            <label for="confirm_password" class="form-label">Confirm New Password</label>
            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
          </div>
          <button type="submit" class="btn btn-danger w-100">Change Password</button>
        </form>
        
        <hr>
        <div class="text-center">
          <a href="{{ url_for('logout') }}" class="text-muted">Logout</a>
        </div>
      </div>
    </div>
    
    <script>
      // Client-side password validation
      document.querySelector('form').addEventListener('submit', function(e) {
        const newPwd = document.getElementById('new_password').value;
        const confirmPwd = document.getElementById('confirm_password').value;
        
        if (newPwd !== confirmPwd) {
          e.preventDefault();
          alert('New passwords do not match.');
          return;
        }
        
        if (newPwd.length < 10) {
          e.preventDefault();
          alert('Password must be at least 10 characters.');
          return;
        }
        
        if (!/[A-Z]/.test(newPwd)) {
          e.preventDefault();
          alert('Password must contain at least one uppercase letter.');
          return;
        }
        
        if (!/[a-z]/.test(newPwd)) {
          e.preventDefault();
          alert('Password must contain at least one lowercase letter.');
          return;
        }
        
        if (!/[0-9]/.test(newPwd)) {
          e.preventDefault();
          alert('Password must contain at least one number.');
          return;
        }
        
        if (!/[!@#$%^&*(),.?":{}|<>_\-+=\[\]\\;'`~]/.test(newPwd)) {
          e.preventDefault();
          alert('Password must contain at least one special character.');
          return;
        }
      });
    </script>
  </body>
</html>
